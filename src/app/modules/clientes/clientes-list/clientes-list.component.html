<div class="clientes-container">
  <!-- Header -->
  <div class="clientes-header">
    <div class="header-left">
      <h1>
        <i-lucide name="users" [size]="32" style="display: inline; vertical-align: middle; margin-right: 12px;"></i-lucide>
        Gestión de Clientes
      </h1>
      <p>Administra todos los clientes del sistema</p>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="nuevoCliente()">
        <i-lucide name="user-plus" [size]="20"></i-lucide>
        <span>Nuevo Cliente</span>
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-section">
    <div class="stat-card blue">
      <div class="stat-icon">
        <i-lucide name="users" [size]="28"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total Clientes</div>
      </div>
    </div>

    <div class="stat-card green">
      <div class="stat-icon">
        <i-lucide name="user-check" [size]="28"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.activos }}</div>
        <div class="stat-label">Activos</div>
      </div>
    </div>

    <div class="stat-card orange">
      <div class="stat-icon">
        <i-lucide name="user-x" [size]="28"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.inactivos }}</div>
        <div class="stat-label">Inactivos</div>
      </div>
    </div>

    <div class="stat-card purple">
      <div class="stat-icon">
        <i-lucide name="user-plus" [size]="28"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.nuevos_mes }}</div>
        <div class="stat-label">Nuevos (30 días)</div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="filtros-grid">
      <div class="filtro-item">
        <label>
          <i-lucide name="search" [size]="16"></i-lucide>
          Buscar
        </label>
        <input
          type="text"
          placeholder="Buscar por nombre, email o documento..."
          [(ngModel)]="filtroBusqueda"
          (input)="onFiltroChange()">
      </div>

      <div class="filtro-item">
        <label>
          <i-lucide name="filter" [size]="16"></i-lucide>
          Estado
        </label>
        <select [(ngModel)]="filtroEstado" (change)="onFiltroChange()">
          <option value="todos">Todos</option>
          <option value="activo">Activos</option>
          <option value="inactivo">Inactivos</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando clientes...</p>
  </div>

  <!-- Lista de Clientes -->
  <div *ngIf="!loading" class="clientes-content">

    <!-- Contador -->
    <div class="contador">
      Mostrando <strong>{{ clientesFiltrados.length }}</strong> de <strong>{{ clientes.length }}</strong> clientes
    </div>

    <!-- Sin resultados -->
    <div *ngIf="clientesFiltrados.length === 0" class="sin-resultados">
      <div class="sin-resultados-icon">
        <i-lucide name="users-2" [size]="80"></i-lucide>
      </div>
      <h3>No se encontraron clientes</h3>
      <p>Intenta ajustar los filtros o crea un nuevo cliente</p>
      <button class="btn-primary" (click)="nuevoCliente()">
        <i-lucide name="user-plus" [size]="20"></i-lucide>
        <span>Nuevo Cliente</span>
      </button>
    </div>

    <!-- Tabla de Clientes -->
    <div *ngIf="clientesFiltrados.length > 0" class="clientes-table-container">
      <table class="clientes-table">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Documento</th>
            <th>Contacto</th>
            <th>Ubicación</th>
            <th>Casos</th>
            <th>Estado</th>
            <th>Fecha Registro</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientesFiltrados"
              class="cliente-row"
              (click)="verDetalle(cliente.id)">

            <td>
              <div class="cliente-info">
                <div class="cliente-avatar">{{ cliente.nombre.charAt(0) }}{{ cliente.apellido.charAt(0) }}</div>
                <div class="cliente-datos">
                  <div class="nombre">{{ getNombreCompleto(cliente) }}</div>
                  <div class="email">{{ cliente.email }}</div>
                </div>
              </div>
            </td>

            <td>
              <div class="documento-info">
                <div class="tipo-doc">{{ getTipoDocumentoTexto(cliente.tipo_documento) }}</div>
                <div class="num-doc">{{ cliente.documento_identidad }}</div>
              </div>
            </td>

            <td>
              <div class="contacto-info">
                <div class="telefono">
                  <i-lucide name="phone" [size]="14" style="display: inline; margin-right: 4px;"></i-lucide>
                  {{ cliente.telefono }}
                </div>
              </div>
            </td>

            <td>
              <div class="ubicacion-info" *ngIf="cliente.ciudad">
                <div>
                  <i-lucide name="map-pin" [size]="14" style="display: inline; margin-right: 4px;"></i-lucide>
                  {{ cliente.ciudad }}
                </div>
                <div class="provincia" *ngIf="cliente.provincia">{{ cliente.provincia }}</div>
              </div>
              <div *ngIf="!cliente.ciudad" class="sin-dato">-</div>
            </td>

            <td>
              <div class="casos-info">
                <div class="casos-activos">
                  <span class="casos-numero">{{ cliente.casos_activos || 0 }}</span>
                  <span class="casos-label">activos</span>
                </div>
                <div class="casos-total">
                  Total: {{ cliente.casos_totales || 0 }}
                </div>
              </div>
            </td>

            <td>
              <span class="estado-badge" [ngClass]="getEstadoClass(cliente.estado)">
                {{ getEstadoTexto(cliente.estado) }}
              </span>
            </td>

            <td>
              <div class="fecha">
                <i-lucide name="calendar" [size]="14" style="display: inline; margin-right: 4px;"></i-lucide>
                {{ formatearFecha(cliente.fecha_registro) }}
              </div>
            </td>

            <td class="acciones-cell" (click)="$event.stopPropagation()">
              <div class="acciones-buttons">
                <button
                  class="btn-accion btn-ver"
                  (click)="verDetalle(cliente.id)"
                  title="Ver detalle">
                  <i-lucide name="eye" [size]="16"></i-lucide>
                </button>

                <button
                  class="btn-accion btn-editar"
                  (click)="editarCliente(cliente.id, $event)"
                  title="Editar">
                  <i-lucide name="edit-2" [size]="16"></i-lucide>
                </button>

                <!--<button
                  *ngIf="cliente.estado === 'activo'"
                  class="btn-accion btn-desactivar"
                  (click)="cambiarEstado(cliente.id, 'inactivo', $event)"
                  title="Desactivar">
                  <i-lucide name="pause-circle" [size]="16"></i-lucide>
                </button>

                <button
                  *ngIf="cliente.estado === 'inactivo'"
                  class="btn-accion btn-activar"
                  (click)="cambiarEstado(cliente.id, 'activo', $event)"
                  title="Activar">
                  <i-lucide name="play-circle" [size]="16"></i-lucide>
                </button>-->

                <button
                  class="btn-accion btn-eliminar"
                  (click)="eliminarCliente(cliente.id, $event)"
                  title="Eliminar">
                  <i-lucide name="trash-2" [size]="16"></i-lucide>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>
