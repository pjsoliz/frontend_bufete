<div class="form-container">
  <!-- Header -->
  <div class="form-header">
    <button class="btn-back" (click)="cancelar()">
      <i-lucide name="arrow-left" [size]="18"></i-lucide>
      Volver
    </button>
    <h1>
      <i-lucide [name]="isEditMode ? 'edit-2' : 'user-plus'" [size]="32"></i-lucide>
      {{ isEditMode ? 'Editar Cliente' : 'Nuevo Cliente' }}
    </h1>
    <p>{{ isEditMode ? 'Modifica los datos del cliente' : 'Completa el formulario para registrar un nuevo cliente' }}</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>{{ isEditMode ? 'Cargando cliente...' : 'Guardando cliente...' }}</p>
  </div>

  <!-- Formulario -->
  <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()" class="cliente-form">

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-alert">
      <i-lucide name="alert-triangle" [size]="20"></i-lucide>
      {{ errorMessage }}
    </div>

    <!-- Sección: Información Personal -->
    <div class="form-section">
      <h2>
        <i-lucide name="user" [size]="24"></i-lucide>
        Información Personal
      </h2>

      <div class="form-grid">

        <!-- Nombre Completo -->
        <div class="form-group full-width">
          <label for="nombreCompleto">
            <i-lucide name="user" [size]="16"></i-lucide>
            Nombre Completo *
          </label>
          <input
            type="text"
            id="nombreCompleto"
            formControlName="nombreCompleto"
            placeholder="Ej: Juan Pérez López"
            [class.error]="clienteForm.get('nombreCompleto')?.invalid && clienteForm.get('nombreCompleto')?.touched">
          <div class="error-message" *ngIf="clienteForm.get('nombreCompleto')?.invalid && clienteForm.get('nombreCompleto')?.touched">
            <i-lucide name="alert-circle" [size]="14"></i-lucide>
            {{ getErrorMessage('nombreCompleto') }}
          </div>
        </div>

        <!-- Teléfono -->
        <div class="form-group">
          <label for="telefono">
            <i-lucide name="phone" [size]="16"></i-lucide>
            Teléfono *
          </label>
          <input
            type="tel"
            id="telefono"
            formControlName="telefono"
            placeholder="71234567"
            maxlength="8"
            [class.error]="clienteForm.get('telefono')?.invalid && clienteForm.get('telefono')?.touched">
          <div class="campo-ayuda">
            <i-lucide name="info" [size]="12"></i-lucide>
            8 dígitos sin espacios ni guiones
          </div>
          <div class="error-message" *ngIf="clienteForm.get('telefono')?.invalid && clienteForm.get('telefono')?.touched">
            <i-lucide name="alert-circle" [size]="14"></i-lucide>
            {{ getErrorMessage('telefono') }}
          </div>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email">
            <i-lucide name="mail" [size]="16"></i-lucide>
            Email
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            placeholder="ejemplo@email.com"
            [class.error]="clienteForm.get('email')?.invalid && clienteForm.get('email')?.touched">
          <div class="campo-ayuda">
            <i-lucide name="info" [size]="12"></i-lucide>
            Opcional
          </div>
          <div class="error-message" *ngIf="clienteForm.get('email')?.invalid && clienteForm.get('email')?.touched">
            <i-lucide name="alert-circle" [size]="14"></i-lucide>
            {{ getErrorMessage('email') }}
          </div>
        </div>

      </div>
    </div>

    <!-- Sección: Información de Contacto -->
    <div class="form-section">
      <h2>
        <i-lucide name="phone" [size]="24"></i-lucide>
        Información de Contacto
      </h2>

      <div class="form-grid">

        <!-- Plataforma -->
        <div class="form-group">
          <label for="plataforma">
            <i-lucide name="smartphone" [size]="16"></i-lucide>
            Plataforma de Origen *
          </label>
          <select 
            id="plataforma" 
            formControlName="plataforma"
            [class.error]="clienteForm.get('plataforma')?.invalid && clienteForm.get('plataforma')?.touched">
            <option *ngFor="let plat of plataformas" [value]="plat.value">
              {{ plat.label }}
            </option>
          </select>
          <div class="campo-ayuda">
            <i-lucide name="info" [size]="12"></i-lucide>
            ¿Cómo contactó al cliente por primera vez?
          </div>
        </div>

        <!-- ID de Usuario en Plataforma -->
        <div class="form-group">
          <label for="userIdPlataforma">
            <i-lucide name="hash" [size]="16"></i-lucide>
            ID de Usuario en Plataforma
          </label>
          <input
            type="text"
            id="userIdPlataforma"
            formControlName="userIdPlataforma"
            placeholder="Opcional">
          <div class="campo-ayuda">
            <i-lucide name="info" [size]="12"></i-lucide>
            {{ getMensajeAyudaPlataforma() }}
          </div>
        </div>

      </div>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="cancelar()" [disabled]="loading">
        <span>Cancelar</span>
      </button>
      <button type="submit" class="btn-primary" [disabled]="clienteForm.invalid || loading">
        <span *ngIf="!loading">{{ isEditMode ? 'Actualizar Cliente' : 'Crear Cliente' }}</span>
        <span *ngIf="loading">Guardando...</span>
      </button>
    </div>

  </form>
</div>