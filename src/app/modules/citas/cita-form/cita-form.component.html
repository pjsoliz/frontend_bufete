<div class="form-container">
  <!-- Header -->
  <div class="form-header">
    <button class="btn-back" (click)="cancelar()">
      <i-lucide name="arrow-left" class="icon"></i-lucide>
      Volver
    </button>
    <h1>
      <i-lucide [name]="isEditMode ? 'edit' : 'plus-circle'" [size]="30" class="icon-title"></i-lucide>
      {{ isEditMode ? 'Editar Cita' : 'Nueva Cita' }}
    </h1>
    <p>{{ isEditMode ? 'Modifica los datos de la cita' : 'Completa el formulario para agendar una nueva cita' }}</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>{{ isEditMode ? 'Cargando cita...' : 'Guardando cita...' }}</p>
  </div>

  <!-- Formulario -->
  <form [formGroup]="citaForm" (ngSubmit)="onSubmit()" class="cita-form">
    
    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-alert">
      <i-lucide name="alert-triangle" class="icon-alert"></i-lucide>
      {{ errorMessage }}
    </div>

    <!-- Sección: Información Básica -->
    <div class="form-section">
      <h2>
        <i-lucide name="calendar" class="icon-section"></i-lucide>
        Fecha y Hora
      </h2>
      
      <div class="form-grid">

        <div class="form-group">
          <label for="cliente">
            <i-lucide name="user" [size]="16"  class="icon-label"></i-lucide>
            Cliente *
          </label>
          <select 
            id="cliente" 
            formControlName="cliente"
            [class.error]="citaForm.get('cliente')?.invalid && citaForm.get('cliente')?.touched">
            <option value="">Seleccione un cliente</option>
            <option *ngFor="let cliente of clientes" [value]="cliente">
              {{ cliente }}
            </option>
          </select>
          <div class="error-message" *ngIf="citaForm.get('cliente')?.invalid && citaForm.get('cliente')?.touched">
            <i-lucide name="alert-circle" [size]="16"  class="icon-error"></i-lucide>
            El cliente es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="tipo">
            <i-lucide name="folder" [size]="16"  class="icon-label"></i-lucide>
            Area de derecho *
          </label>
          <select 
            id="tipo" 
            formControlName="tipo"
            [class.error]="citaForm.get('tipo')?.invalid && citaForm.get('tipo')?.touched">
            <option value="">Seleccione un tipo</option>
            <option *ngFor="let tipo of tiposCita" [value]="tipo">
              {{ tipo }}
            </option>
          </select>
          <div class="error-message" *ngIf="citaForm.get('tipo')?.invalid && citaForm.get('tipo')?.touched">
            <i-lucide name="alert-circle" [size]="16"  class="icon-error"></i-lucide>
            El area de derecho es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="tipo">
            <i-lucide name="folder" [size]="16"  class="icon-label"></i-lucide>
            Tipo de caso *
          </label>
          <select 
            id="tipo" 
            formControlName="tipo"
            [class.error]="citaForm.get('tipo')?.invalid && citaForm.get('tipo')?.touched">
            <option value="">Seleccione un tipo</option>
            <option *ngFor="let tipo of tiposCita" [value]="tipo">
              {{ tipo }}
            </option>
          </select>
          <div class="error-message" *ngIf="citaForm.get('tipo')?.invalid && citaForm.get('tipo')?.touched">
            <i-lucide name="alert-circle" [size]="16"  class="icon-error"></i-lucide>
            El tipo de caso es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="tipo">
            <i-lucide name="folder" [size]="16"  class="icon-label"></i-lucide>
            Tipo de Cita *
          </label>
          <select 
            id="tipo" 
            formControlName="tipo"
            [class.error]="citaForm.get('tipo')?.invalid && citaForm.get('tipo')?.touched">
            <option value="">Seleccione un tipo</option>
            <option *ngFor="let tipo of tiposCita" [value]="tipo">
              {{ tipo }}
            </option>
          </select>
          <div class="error-message" *ngIf="citaForm.get('tipo')?.invalid && citaForm.get('tipo')?.touched">
            <i-lucide name="alert-circle" [size]="16"  class="icon-error"></i-lucide>
            El tipo de cita es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="abogado">
            <i-lucide name="briefcase" [size]="16"  class="icon-label"></i-lucide>
            Abogado *
          </label>
          <select 
            id="abogado" 
            formControlName="abogado"
            [class.error]="citaForm.get('abogado')?.invalid && citaForm.get('abogado')?.touched">
            <option value="">Seleccione un abogado</option>
            <option *ngFor="let abogado of abogados" [value]="abogado">
              {{ abogado }}
            </option>
          </select>
          <div class="error-message" *ngIf="citaForm.get('abogado')?.invalid && citaForm.get('abogado')?.touched">
            <i-lucide name="alert-circle" [size]="16"  class="icon-error"></i-lucide>
            El abogado es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="fecha">
            <i-lucide name="calendar" [size]="16"  class="icon-label"></i-lucide>
            Fecha *
          </label>
          <input 
            type="date" 
            id="fecha" 
            formControlName="fecha"
            [class.error]="citaForm.get('fecha')?.invalid && citaForm.get('fecha')?.touched">
          <div class="error-message" *ngIf="citaForm.get('fecha')?.invalid && citaForm.get('fecha')?.touched">
            <i-lucide name="alert-circle"  [size]="16"  class="icon-error"></i-lucide>
            La fecha es requerida
          </div>
        </div>

        <div class="form-group">
          <label for="hora">
            <i-lucide name="clock" [size]="16"  class="icon-label"></i-lucide>
            Hora *
          </label>
          <input 
            type="time" 
            id="hora" 
            formControlName="hora"
            [class.error]="citaForm.get('hora')?.invalid && citaForm.get('hora')?.touched">
          <div class="error-message" *ngIf="citaForm.get('hora')?.invalid && citaForm.get('hora')?.touched">
            <i-lucide name="alert-circle" [size]="16"  class="icon-error"></i-lucide>
            La hora es requerida
          </div>
        </div>
        
        <div class="form-group full-width">
        <label for="notas">
          <i-lucide name="file-text" [size]="16"  class="icon-label"></i-lucide>
          Descripcion
        </label>
        <textarea 
          id="notas" 
          formControlName="notas"
          rows="4"
          placeholder="Agregue notas adicionales sobre la cita..."></textarea>
      </div>
      
      </div>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="cancelar()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn-primary" [disabled]="citaForm.invalid || loading">
        <span *ngIf="!loading">{{ isEditMode ? 'Actualizar Cita' : 'Crear Cita' }}</span>
        <span *ngIf="loading">Guardando...</span>
      </button>
    </div>

  </form>
</div>