<div class="citas-container">
  <div class="page-header">
    <div>
      <h1>📅 Gestión de Citas</h1>
      <p>Administra todas las citas y reuniones</p>
    </div>
    <button class="btn-primary" routerLink="/citas/nueva">
  ➕ Nueva Cita
</button>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <select [(ngModel)]="filtroEstado" class="filter-select">
      <option value="">Todos los estados</option>
      <option value="PENDIENTE">Pendiente</option>
      <option value="CONFIRMADA">Confirmada</option>
      <option value="COMPLETADA">Completada</option>
      <option value="CANCELADA">Cancelada</option>
      <option value="NO_ASISTIO">No Asistió</option>
    </select>

    <select [(ngModel)]="filtroModalidad" class="filter-select">
      <option value="">Todas las modalidades</option>
      <option value="PRESENCIAL">Presencial</option>
      <option value="VIRTUAL">Virtual</option>
      <option value="TELEFONICA">Telefónica</option>
    </select>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando citas...</p>
  </div>

  <!-- Lista de Citas -->
  <div *ngIf="!loading" class="citas-list">
    <div *ngFor="let cita of citasFiltradas" class="cita-card">
      <div class="cita-header">
        <div class="cita-fecha">
          <div class="fecha-dia">{{ cita.fecha_hora | date:'dd' }}</div>
          <div class="fecha-mes">{{ cita.fecha_hora | date:'MMM' }}</div>
        </div>
        <div class="cita-info">
          <h3>{{ cita.tipo_cita }}</h3>
          <div class="cita-horario">
            🕒 {{ cita.fecha_hora | date:'HH:mm' }} - {{ cita.duracion_minutos }} min
          </div>
        </div>
        <span [class]="'badge ' + getEstadoBadgeClass(cita.estado)">
          {{ cita.estado }}
        </span>
      </div>

      <div class="cita-body">
        <div class="info-row">
          <span class="info-icon">👤</span>
          <span><strong>Cliente:</strong> {{ cita.cliente.nombre }} {{ cita.cliente.apellido }}</span>
        </div>
        <div class="info-row">
          <span class="info-icon">⚖️</span>
          <span><strong>Abogado:</strong> {{ cita.abogado.nombre }} {{ cita.abogado.apellido }}</span>
        </div>
        <div class="info-row">
          <span class="info-icon">{{ getModalidadIcon(cita.modalidad) }}</span>
          <span><strong>Modalidad:</strong> {{ cita.modalidad }}</span>
        </div>
        <div class="info-row" *ngIf="cita.ubicacion">
          <span class="info-icon">📍</span>
          <span>{{ cita.ubicacion }}</span>
        </div>
        <div class="info-row" *ngIf="cita.link_virtual">
          <span class="info-icon">🔗</span>
          <a [href]="cita.link_virtual" target="_blank" class="link-virtual">Unirse a reunión virtual</a>
        </div>
        <div class="info-row" *ngIf="cita.notas">
          <span class="info-icon">📝</span>
          <span>{{ cita.notas }}</span>
        </div>
      </div>

      <div class="cita-footer">
        <button class="btn-action" *ngIf="cita.estado === 'PENDIENTE'">
          ✓ Confirmar
        </button>
        <button class="btn-action danger" *ngIf="cita.estado !== 'CANCELADA' && cita.estado !== 'COMPLETADA'">
          ✕ Cancelar
        </button>
      </div>
    </div>

    <div *ngIf="citasFiltradas.length === 0" class="empty-state">
      <div class="empty-icon">📅</div>
      <h3>No hay citas</h3>
      <p>No se encontraron citas con los filtros seleccionados</p>
    </div>
  </div>
</div>
