<div class="citas-container">
  <!-- Header -->
  <div class="citas-header">
    <div class="header-left">
      <h1>
        <i-lucide name="calendar" [size]="32" class="icon-title"></i-lucide>
        Gestión de Citas
      </h1>
      <p>Administra todas las citas del sistema</p>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="nuevaCita()">
        <i-lucide name="plus" [size]="20" class="icon-btn"></i-lucide>
        Nueva Cita
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <i-lucide name="calendar" [size]="24"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total Citas</div>
      </div>
    </div>

    <div class="stat-card stat-pendiente">
      <div class="stat-icon">
        <i-lucide name="clock" [size]="24"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.pendientes }}</div>
        <div class="stat-label">Pendientes</div>
      </div>
    </div>

    <div class="stat-card stat-confirmada">
      <div class="stat-icon">
        <i-lucide name="check-circle" [size]="24"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.confirmadas }}</div>
        <div class="stat-label">Confirmadas</div>
      </div>
    </div>

    <div class="stat-card stat-completada">
      <div class="stat-icon">
        <i-lucide name="check" [size]="24"></i-lucide>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.completadas }}</div>
        <div class="stat-label">Completadas</div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="filtros-grid">
      <div class="filtro-item">
        <label>
          <i-lucide name="search" [size]="17" class="icon-label"></i-lucide>
          Buscar
        </label>
        <input
          type="text"
          placeholder="Buscar por cliente, abogado o motivo..."
          [(ngModel)]="filtroBusqueda"
          (input)="onFiltroChange()">
      </div>

      <div class="filtro-item">
        <label>
          <i-lucide name="filter" [size]="17" class="icon-label"></i-lucide>
          Estado
        </label>
        <select [(ngModel)]="filtroEstado" (change)="onFiltroChange()">
          <option value="todos">Todas</option>
          <option value="pendiente">Pendiente</option>
          <option value="confirmada">Confirmada</option>
          <option value="completada">Completada</option>
          <option value="cancelada">Cancelada</option>
        </select>
      </div>

      <div class="filtro-item">
        <label>
          <i-lucide name="calendar" [size]="17" class="icon-label"></i-lucide>
          Fecha
        </label>
        <input
          type="date"
          [(ngModel)]="filtroFecha"
          (change)="onFiltroChange()">
      </div>

      <div class="filtro-item">
        <label>
          <i-lucide name="alert-triangle" [size]="17" class="icon-label"></i-lucide>
          Urgencia
        </label>
        <select [(ngModel)]="filtroUrgencia" (change)="onFiltroChange()">
          <option value="todos">Todas</option>
          <option value="alta">Alta</option>
          <option value="media">Media</option>
          <option value="baja">Baja</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando citas...</p>
  </div>

  <!-- Lista de Citas -->
  <div *ngIf="!loading" class="citas-content">

    <!-- Contador -->
    <div class="contador">
      Mostrando <strong>{{ citasFiltradas.length }}</strong> de <strong>{{ citas.length }}</strong> citas
    </div>

    <!-- Sin resultados -->
    <div *ngIf="citasFiltradas.length === 0" class="sin-resultados">
      <div class="sin-resultados-icon">
        <i-lucide name="calendar" [size]="80"></i-lucide>
      </div>
      <h3>No se encontraron citas</h3>
      <p>Intenta ajustar los filtros o crea una nueva cita</p>
      <button class="btn-primary" (click)="nuevaCita()">
        <i-lucide name="plus" [size]="20"></i-lucide>
        Nueva Cita
      </button>
    </div>

    <!-- Tabla de Citas -->
    <div *ngIf="citasFiltradas.length > 0" class="citas-table-container">
      <table class="citas-table">
        <thead>
          <tr>
            <th>Fecha y Hora</th>
            <th>Cliente</th>
            <th>Abogado</th>
            <th>Tipo de Cita</th>
            <th>Área de Derecho</th>
            <th>Urgencia</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cita of citasFiltradas"
              class="cita-row"
              [class.cita-proxima]="esCitaProxima(cita.fecha, cita.hora)"
              (click)="verDetalle(cita.id)">

            <!-- Fecha y Hora -->
            <td>
              <div class="fecha-info">
                <div class="fecha">{{ formatearFecha(cita.fecha) }}</div>
                <div class="hora">
                  <i-lucide name="clock" [size]="16" class="icon-inline"></i-lucide>
                  {{ cita.hora }}
                </div>
              </div>
            </td>

            <!-- Cliente -->
            <td>
              <div class="cliente-info">
                <i-lucide name="user" [size]="16" class="icon-inline"></i-lucide>
                <span>{{ cita.cliente.nombreCompleto }}</span>
              </div>
            </td>

            <!-- Abogado -->
            <td>
              <div class="abogado-info">
                <i-lucide name="briefcase" [size]="16" class="icon-inline"></i-lucide>
                <span>{{ cita.abogado.nombreCompleto }}</span>
              </div>
            </td>

            <!-- Tipo de Cita -->
            <td>
              <span class="tipo-badge">{{ cita.tipoCita.nombre }}</span>
            </td>

            <!-- Área de Derecho -->
            <td>
              <span class="area-badge">{{ cita.areaDerecho.nombre }}</span>
            </td>

            <!-- Urgencia -->
            <td>
              <span class="urgencia-badge" [ngClass]="getUrgenciaClass(cita.urgencia)">
                {{ getUrgenciaTexto(cita.urgencia) }}
              </span>
            </td>

            <!-- Estado -->
            <td>
              <span class="estado-badge" [ngClass]="getEstadoClass(cita.estado)">
                {{ getEstadoTexto(cita.estado) }}
              </span>
            </td>

            <!-- Acciones -->
            <td class="acciones-cell" (click)="$event.stopPropagation()">
              <div class="acciones-buttons">

                <!-- Botón Ver -->
                <button
                  class="btn-accion btn-ver"
                  (click)="verDetalle(cita.id)"
                  title="Ver detalle">
                  <i-lucide name="eye" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <!-- Botón Confirmar (solo si está pendiente) -->
                <button
                  *ngIf="cita.estado === 'pendiente'"
                  class="btn-accion btn-confirmar"
                  (click)="confirmarCita(cita.id, $event)"
                  title="Confirmar">
                  <i-lucide name="check-circle" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <!-- Botón Completar (solo si está confirmada) -->
                <button
                  *ngIf="cita.estado === 'confirmada'"
                  class="btn-accion btn-completar"
                  (click)="completarCita(cita.id, $event)"
                  title="Completar">
                  <i-lucide name="check" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <!-- Botón Editar (solo si no está completada o cancelada) -->
                <button
                  *ngIf="cita.estado !== 'completada' && cita.estado !== 'cancelada'"
                  class="btn-accion btn-editar"
                  (click)="editarCita(cita.id, $event)"
                  title="Editar">
                  <i-lucide name="edit-2" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <!-- Botón Cancelar (solo si no está completada o cancelada) -->
                <button
                  *ngIf="cita.estado !== 'completada' && cita.estado !== 'cancelada'"
                  class="btn-accion btn-cancelar"
                  (click)="cancelarCita(cita.id, $event)"
                  title="Cancelar">
                  <i-lucide name="x-circle" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <!-- Botón Eliminar
                <button
                  class="btn-accion btn-eliminar"
                  (click)="eliminarCita(cita.id, $event)"
                  title="Eliminar">
                  <i-lucide name="trash-2" [size]="16" class="icon-accion"></i-lucide>
                </button>-->
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>