<div class="citas-container">
  <!-- Header -->
  <div class="citas-header">
    <div class="header-left">
      <h1>
        <i-lucide name="calendar" [size]="32" class="icon-title"></i-lucide>
        Gestión de Citas
      </h1>
      <p>Administra todas las citas del sistema</p>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="nuevaCita()">
        <i-lucide name="plus"  [size]="20" class="icon-btn"></i-lucide>
        Nueva Cita
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="filtros-grid">
      <div class="filtro-item">
        <label>
          <i-lucide name="search" [size]="17" class="icon-label"></i-lucide>
          Buscar
        </label>
        <input
          type="text"
          placeholder="Buscar por cliente, abogado o tipo..."
          [(ngModel)]="filtroBusqueda"
          (input)="onFiltroBusquedaChange($event)">
      </div>

      <div class="filtro-item">
        <label>
          <i-lucide name="activity" [size]="17"  class="icon-label"></i-lucide>
          Estado
        </label>
        <select (change)="onFiltroEstadoChange($event)">
          <option value="todas">Todas</option>
          <option value="programada">Programada</option>
          <option value="confirmada">Confirmada</option>
          <option value="completada">Completada</option>
          <option value="cancelada">Cancelada</option>
        </select>
      </div>

      <div class="filtro-item">
        <label>
          <i-lucide name="calendar" [size]="17" class="icon-label"></i-lucide>
          Fecha
        </label>
        <input
          type="date"
          [(ngModel)]="filtroFecha"
          (change)="onFiltroFechaChange($event)">
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando citas...</p>
  </div>

  <!-- Lista de Citas -->
  <div *ngIf="!loading" class="citas-content">

    <!-- Contador -->
    <div class="contador">
      Mostrando <strong>{{ citasFiltradas.length }}</strong> de <strong>{{ citas.length }}</strong> citas
    </div>

    <!-- Sin resultados -->
    <div *ngIf="citasFiltradas.length === 0" class="sin-resultados">
      <div class="sin-resultados-icon">
        <i-lucide name="calendar-x" class="icon-empty"></i-lucide>
      </div>
      <h3>No se encontraron citas</h3>
      <p>Intenta ajustar los filtros o crea una nueva cita</p>
      <button class="btn-primary" (click)="nuevaCita()">
        Nueva Cita
      </button>
    </div>

    <!-- Tabla de Citas -->
    <div *ngIf="citasFiltradas.length > 0" class="citas-table-container">
      <table class="citas-table">
        <thead>
          <tr>
            <th>Fecha y Hora</th>
            <th>Cliente</th>
            <th>Abogado</th>
            <th>Tipo</th>
            <th>Duración</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cita of citasFiltradas"
              class="cita-row"
              (click)="verDetalle(cita.id)">

            <td>
              <div class="fecha-info">
                <div class="fecha">{{ formatearFecha(cita.fecha) }}</div>
                <div class="hora">
                  <i-lucide name="clock" [size]="16" class="icon-inline"></i-lucide>
                  {{ cita.hora }}
                </div>
              </div>
            </td>

            <td>
              <div class="cliente-info">
                <i-lucide name="user" [size]="16" class="icon-inline"></i-lucide>
                <span>{{ cita.cliente }}</span>
              </div>
            </td>

            <td>
              <div class="abogado-info">
                <i-lucide name="briefcase" [size]="16" class="icon-inline"></i-lucide>
                <span>{{ cita.abogado }}</span>
              </div>
            </td>

            <td>
              <span class="tipo-badge">{{ cita.tipo }}</span>
            </td>

            <td>
              <div class="abogado-info">
                <i-lucide name="clock" [size]="16" class="icon-inline"></i-lucide>
                <span class="duracion">{{ cita.duracion }} min</span>
              </div>
            </td>

            <td>
              <span class="estado-badge" [class]="getEstadoClass(cita.estado)">
                {{ getEstadoTexto(cita.estado) }}
              </span>
            </td>

            <td class="acciones-cell">
              <div class="acciones-buttons">

                <button
                  *ngIf="cita.estado === 'confirmada'"
                  class="btn-accion btn-confirmar"
                  (click)="confirmarCita(cita.id, $event)"
                  title="Confirmar">
                  <i-lucide name="check-circle" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <button
                  *ngIf="cita.estado === 'confirmada'"
                  class="btn-accion btn-completar"
                  (click)="completarCita(cita.id, $event)"
                  title="Completar">
                  <i-lucide name="check" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <button
                  class="btn-accion btn-editar"
                  (click)="editarCita(cita.id); $event.stopPropagation()"
                  title="Editar">
                  <i-lucide name="pencil" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <button
                  *ngIf="cita.estado !== 'cancelada' && cita.estado !== 'completada'"
                  class="btn-accion btn-cancelar"
                  (click)="cancelarCita(cita.id, $event)"
                  title="Cancelar">
                  <i-lucide name="x-circle" [size]="16" class="icon-accion"></i-lucide>
                </button>

                <button
                  class="btn-accion btn-eliminar"
                  (click)="eliminarCita(cita.id, $event)"
                  title="Eliminar">
                  <i-lucide name="trash-2" [size]="16" class="icon-accion"></i-lucide>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>