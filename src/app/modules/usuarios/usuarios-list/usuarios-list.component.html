<div class="usuarios-container">
  <!-- Header -->
  <div class="usuarios-header">
    <div class="header-left">
      <h1>👥 Gestión de Usuarios</h1>
      <p>Administra los usuarios del sistema</p>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="nuevoUsuario()">
        <span class="btn-icon">➕</span>
        Nuevo Usuario
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-section">
    <div class="stat-card blue">
      <div class="stat-icon">📊</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total Usuarios</div>
      </div>
    </div>

    <div class="stat-card purple">
      <div class="stat-icon">👑</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.administradores }}</div>
        <div class="stat-label">Administradores</div>
      </div>
    </div>

    <div class="stat-card green">
      <div class="stat-icon">⚖️</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.abogados }}</div>
        <div class="stat-label">Abogados</div>
      </div>
    </div>

    <div class="stat-card orange">
      <div class="stat-icon">📋</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.asistentes }}</div>
        <div class="stat-label">Asistentes</div>
      </div>
    </div>

    <div class="stat-card teal">
      <div class="stat-icon">✅</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.activos }}</div>
        <div class="stat-label">Activos</div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="filtros-grid">
      <div class="filtro-item">
        <label>🔍 Buscar</label>
        <input
          type="text"
          placeholder="Buscar por nombre, email o usuario..."
          [(ngModel)]="filtroBusqueda"
          (input)="onFiltroChange()">
      </div>

      <div class="filtro-item">
        <label>👤 Rol</label>
        <select [(ngModel)]="filtroRol" (change)="onFiltroChange()">
          <option value="todos">Todos</option>
          <option value="administrador">Administrador</option>
          <option value="abogado">Abogado</option>
          <option value="asistente_legal">Asistente Legal</option>
        </select>
      </div>

      <div class="filtro-item">
        <label>📊 Estado</label>
        <select [(ngModel)]="filtroEstado" (change)="onFiltroChange()">
          <option value="todos">Todos</option>
          <option value="activo">Activos</option>
          <option value="inactivo">Inactivos</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando usuarios...</p>
  </div>

  <!-- Lista de Usuarios -->
  <div *ngIf="!loading" class="usuarios-content">

    <!-- Contador -->
    <div class="contador">
      Mostrando <strong>{{ usuariosFiltrados.length }}</strong> de <strong>{{ usuarios.length }}</strong> usuarios
    </div>

    <!-- Sin resultados -->
    <div *ngIf="usuariosFiltrados.length === 0" class="sin-resultados">
      <div class="sin-resultados-icon">🔍</div>
      <h3>No se encontraron usuarios</h3>
      <p>Intenta ajustar los filtros o crea un nuevo usuario</p>
      <button class="btn-primary" (click)="nuevoUsuario()">
        Nuevo Usuario
      </button>
    </div>

    <!-- Tabla de Usuarios -->
    <div *ngIf="usuariosFiltrados.length > 0" class="usuarios-table-container">
      <table class="usuarios-table">
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Email / Username</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Teléfono</th>
            <th>Casos Asignados</th>
            <th>Último Acceso</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let usuario of usuariosFiltrados"
              class="usuario-row"
              (click)="verDetalle(usuario.id)">

            <td>
              <div class="usuario-info">
                <div class="usuario-avatar">
                  <span class="avatar-icon">{{ getRolIcon(usuario.rol) }}</span>
                </div>
                <div class="usuario-datos">
                  <div class="nombre">{{ getNombreCompleto(usuario) }}</div>
                  <div class="especialidad" *ngIf="usuario.especialidad">
                    {{ usuario.especialidad }}
                  </div>
                </div>
              </div>
            </td>

            <td>
              <div class="email-username">
                <div class="email">📧 {{ usuario.email }}</div>
                <div class="username">👤 @{{ usuario.username }}</div>
              </div>
            </td>

            <td>
              <span class="rol-badge" [ngClass]="getRolClass(usuario.rol)">
                {{ getRolIcon(usuario.rol) }} {{ getRolTexto(usuario.rol) }}
              </span>
            </td>

            <td>
              <span class="estado-badge" [ngClass]="getEstadoClass(usuario.estado)">
                {{ getEstadoTexto(usuario.estado) }}
              </span>
            </td>

            <td>
              <div class="telefono" *ngIf="usuario.telefono">
                📞 {{ usuario.telefono }}
              </div>
              <div *ngIf="!usuario.telefono" class="sin-dato">-</div>
            </td>

            <td>
              <div class="casos-asignados" *ngIf="usuario.rol === 'abogado'">
                <span class="casos-numero">{{ usuario.casos_asignados || 0 }}</span>
                <span class="casos-texto">casos</span>
              </div>
              <div *ngIf="usuario.rol !== 'abogado'" class="sin-dato">-</div>
            </td>

            <td>
              <div class="ultimo-acceso" *ngIf="usuario.ultimo_acceso">
                {{ formatearFecha(usuario.ultimo_acceso) }}
              </div>
              <div *ngIf="!usuario.ultimo_acceso" class="sin-dato">-</div>
            </td>

            <td class="acciones-cell" (click)="$event.stopPropagation()">
              <div class="acciones-buttons">
                <button
                  class="btn-accion btn-ver"
                  (click)="verDetalle(usuario.id)"
                  title="Ver detalle">
                  👁️
                </button>

                <button
                  class="btn-accion btn-editar"
                  (click)="editarUsuario(usuario.id, $event)"
                  title="Editar">
                  ✏️
                </button>

                <button
                  *ngIf="usuario.estado === 'activo'"
                  class="btn-accion btn-desactivar"
                  (click)="cambiarEstado(usuario.id, 'inactivo', $event)"
                  title="Desactivar">
                  ⏸️
                </button>

                <button
                  *ngIf="usuario.estado === 'inactivo'"
                  class="btn-accion btn-activar"
                  (click)="cambiarEstado(usuario.id, 'activo', $event)"
                  title="Activar">
                  ▶️
                </button>

                <button
                  class="btn-accion btn-eliminar"
                  (click)="eliminarUsuario(usuario.id, $event)"
                  title="Eliminar">
                  🗑️
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>
