<div class="detalle-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando usuario...</p>
  </div>

  <!-- Error -->
  <div *ngIf="!loading && errorMessage" class="error-container">
    <i-lucide name="alert-triangle" class="error-icon"></i-lucide>
    <h2>{{ errorMessage }}</h2>
    <button class="btn-primary" (click)="volver()">Volver a Usuarios</button>
  </div>

  <!-- Detalle del Usuario -->
  <div *ngIf="!loading && usuario" class="detalle-content">

    <!-- Header -->
    <div class="detalle-header">
      <button class="btn-back" (click)="volver()">
        <i-lucide name="arrow-left" class="icon-back"></i-lucide>
        Volver
      </button>

      <div class="header-main">
        <div class="header-left">
          <div class="usuario-avatar-large">
            <i-lucide [name]="getRolIconName(usuario.rol)" [size]="60" class="avatar-icon-large"></i-lucide>
          </div>
          <div class="usuario-info-header">
            <h1>{{ usuario.nombreCompleto }}</h1>
            <div class="badges-row">
              <span class="badge-rol" [ngClass]="getRolClass(usuario.rol)">
                <i-lucide [name]="getRolIconName(usuario.rol)" [size]="16" class="icon-badge"></i-lucide>
                {{ getRolTexto(usuario.rol) }}
              </span>
              <span class="badge-estado" [ngClass]="getEstadoClass(usuario.activo)">
                {{ getEstadoTexto(usuario.activo) }}
              </span>
            </div>
            <div class="username-email">
              <span class="email">
                <i-lucide name="mail" [size]="16" class="icon-small"></i-lucide>
                {{ usuario.email }}
              </span>
            </div>
          </div>
        </div>

        <div class="header-right">
          <button class="btn-action" (click)="cambiarEstado()"
                  [title]="usuario.activo ? 'Desactivar' : 'Activar'">
            <i-lucide [name]="usuario.activo ? 'pause-circle' : 'play-circle'" [size]="20" class="icon-btn"></i-lucide>
            {{ usuario.activo ? 'Desactivar' : 'Activar' }}
          </button>
          <button class="btn-action btn-edit" (click)="editarUsuario()">
            <i-lucide name="pencil" [size]="20"  class="icon-btn"></i-lucide>
            Editar
          </button>
          <button class="btn-action btn-delete" (click)="eliminarUsuario()">
            <i-lucide name="trash-2" [size]="20"  class="icon-btn"></i-lucide>
            Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">

      <!-- Columna Izquierda -->
      <div class="left-column">

        <!-- Información de Contacto -->
        <div class="info-card">
          <h2>
            <i-lucide name="mail" class="icon-section"></i-lucide>
            Información de Contacto
          </h2>

          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Email</div>
              <div class="info-value">
                <i-lucide name="mail" [size]="16"  class="icon"></i-lucide>
                <a [href]="'mailto:' + usuario.email">{{ usuario.email }}</a>
              </div>
            </div>
          </div>
        </div>

        <!-- Información del Sistema -->
        <div class="info-card">
          <h2>
            <i-lucide name="monitor" class="icon-section"></i-lucide>
            Información del Sistema
          </h2>

          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Fecha de Registro</div>
              <div class="info-value">
                <i-lucide name="calendar" [size]="16" class="icon"></i-lucide>
                <span *ngIf="usuario.createdAt">{{ formatearFecha(usuario.createdAt) }}</span>
                <span *ngIf="!usuario.createdAt" class="sin-dato">No registrado</span>
              </div>
            </div>

            <div class="info-item" *ngIf="usuario.ultimoAcceso">
              <div class="info-label">Último Acceso</div>
              <div class="info-value">
                <i-lucide name="clock" [size]="16" class="icon"></i-lucide>
                {{ formatearFecha(usuario.ultimoAcceso) }}
              </div>
            </div>

            <div class="info-item" *ngIf="calcularDiasDesdeAcceso() !== null">
              <div class="info-label">Actividad</div>
              <div class="info-value">
                <i-lucide name="activity" [size]="16" class="icon"></i-lucide>
                <span *ngIf="calcularDiasDesdeAcceso() === 0" class="texto-verde">Activo hoy</span>
                <span *ngIf="calcularDiasDesdeAcceso()! > 0 && calcularDiasDesdeAcceso()! <= 7" class="texto-verde">
                  Hace {{ calcularDiasDesdeAcceso() }} días
                </span>
                <span *ngIf="calcularDiasDesdeAcceso()! > 7" class="texto-naranja">
                  Inactivo {{ calcularDiasDesdeAcceso() }} días
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Permisos -->
        <div class="info-card permisos-card">
          <h2>
            <i-lucide name="shield" class="icon-section"></i-lucide>
            Permisos del Rol
          </h2>

          <div class="permisos-lista">
            <div class="permiso-item" *ngIf="usuario.rol === 'admin'">
              <i-lucide name="check-circle" [size]="16" class="permiso-check"></i-lucide>
              <div class="permiso-texto">
                <strong>Acceso Total al Sistema</strong>
                <p>Gestión completa de usuarios, citas, clientes y configuración del sistema.</p>
              </div>
            </div>

            <div class="permiso-item" *ngIf="usuario.rol === 'asistente_legal'">
              <i-lucide name="check-circle" [size]="16" class="permiso-check"></i-lucide>
              <div class="permiso-texto">
                <strong>Soporte Administrativo</strong>
                <p>Gestionar citas, clientes y dar soporte general.</p>
              </div>
            </div>

            <div class="permiso-item" *ngIf="usuario.rol === 'asistente_legal'">
              <i-lucide name="check-circle" [size]="16" class="permiso-check"></i-lucide>
              <div class="permiso-texto">
                <strong>Gestión de Agenda</strong>
                <p>Administrar calendario y citas del bufete.</p>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Columna Derecha -->
      <div class="right-column">
        <div class="info-adicional-card">
          <h2>
            <i-lucide name="info" class="icon-section"></i-lucide>
            Información Adicional
          </h2>

          <div class="info-box">
            <i-lucide [name]="getRolIconName(usuario.rol)" [size]="48" class="info-box-icon"></i-lucide>
            <div class="info-box-content">
              <h3>{{ getRolTexto(usuario.rol) }}</h3>
              <p *ngIf="usuario.rol === 'admin'">
                Este usuario tiene permisos de administrador con acceso completo al sistema.
              </p>
              <p *ngIf="usuario.rol === 'asistente_legal'">
                Este usuario proporciona soporte administrativo y gestiona tareas generales del sistema.
              </p>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>