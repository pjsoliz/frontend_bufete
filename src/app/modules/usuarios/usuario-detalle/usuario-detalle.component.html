<div class="detalle-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando usuario...</p>
  </div>

  <!-- Error -->
  <div *ngIf="!loading && errorMessage" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>{{ errorMessage }}</h2>
    <button class="btn-primary" (click)="volver()">Volver a Usuarios</button>
  </div>

  <!-- Detalle del Usuario -->
  <div *ngIf="!loading && usuario" class="detalle-content">

    <!-- Header -->
    <div class="detalle-header">
      <button class="btn-back" (click)="volver()">‚Üê Volver</button>

      <div class="header-main">
        <div class="header-left">
          <div class="usuario-avatar-large">
            {{ getRolIcon(usuario.rol) }}
          </div>
          <div class="usuario-info-header">
            <h1>{{ getNombreCompleto() }}</h1>
            <div class="badges-row">
              <span class="badge-rol" [ngClass]="getRolClass(usuario.rol)">
                {{ getRolIcon(usuario.rol) }} {{ getRolTexto(usuario.rol) }}
              </span>
              <span class="badge-estado" [ngClass]="getEstadoClass(usuario.estado)">
                {{ getEstadoTexto(usuario.estado) }}
              </span>
            </div>
            <div class="username-email">
              <span class="username">üë§ @{{ usuario.username }}</span>
              <span class="email">üìß {{ usuario.email }}</span>
            </div>
          </div>
        </div>

        <div class="header-right">
          <button class="btn-action" (click)="cambiarEstado()"
                  [title]="usuario.estado === 'activo' ? 'Desactivar' : 'Activar'">
            {{ usuario.estado === 'activo' ? '‚è∏Ô∏è Desactivar' : '‚ñ∂Ô∏è Activar' }}
          </button>
          <button class="btn-action btn-edit" (click)="editarUsuario()">
            ‚úèÔ∏è Editar
          </button>
          <button class="btn-action btn-delete" (click)="eliminarUsuario()">
            üóëÔ∏è Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">

      <!-- Columna Izquierda -->
      <div class="left-column">

        <!-- Informaci√≥n de Contacto -->
        <div class="info-card">
          <h2>üìû Informaci√≥n de Contacto</h2>

          <div class="info-grid">
            <div class="info-item full-width">
              <div class="info-label">Email</div>
              <div class="info-value">
                <span class="icon">üìß</span>
                <a [href]="'mailto:' + usuario.email">{{ usuario.email }}</a>
              </div>
            </div>

            <div class="info-item" *ngIf="usuario.telefono">
              <div class="info-label">Tel√©fono</div>
              <div class="info-value">
                <span class="icon">üì±</span>
                <a [href]="'tel:' + usuario.telefono">{{ usuario.telefono }}</a>
              </div>
            </div>

            <div class="info-item">
              <div class="info-label">Usuario del Sistema</div>
              <div class="info-value">
                <span class="icon">üë§</span>
                @{{ usuario.username }}
              </div>
            </div>
          </div>
        </div>

        <!-- Informaci√≥n Profesional -->
        <div class="info-card" *ngIf="usuario.rol === 'abogado' && usuario.especialidad">
          <h2>‚öñÔ∏è Informaci√≥n Profesional</h2>

          <div class="info-grid">
            <div class="info-item full-width">
              <div class="info-label">Especialidad</div>
              <div class="info-value especialidad-destacada">
                <span class="icon">üìö</span>
                {{ usuario.especialidad }}
              </div>
            </div>

            <div class="info-item">
              <div class="info-label">Casos Asignados</div>
              <div class="info-value">
                <span class="casos-numero-grande">{{ usuario.casos_asignados || 0 }}</span>
                <span class="casos-texto">casos activos</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Informaci√≥n del Sistema -->
        <div class="info-card">
          <h2>üíª Informaci√≥n del Sistema</h2>

          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Fecha de Registro</div>
              <div class="info-value">
                <span class="icon">üìÖ</span>
                {{ formatearFecha(usuario.fecha_registro) }}
              </div>
            </div>

            <div class="info-item" *ngIf="usuario.ultimo_acceso">
              <div class="info-label">√öltimo Acceso</div>
              <div class="info-value">
                <span class="icon">üïê</span>
                {{ formatearFecha(usuario.ultimo_acceso) }}
              </div>
            </div>

            <div class="info-item" *ngIf="calcularDiasDesdeAcceso() !== null">
              <div class="info-label">Actividad</div>
              <div class="info-value">
                <span class="icon">üìä</span>
                <span *ngIf="calcularDiasDesdeAcceso() === 0" class="texto-verde">Activo hoy</span>
                <span *ngIf="calcularDiasDesdeAcceso()! > 0 && calcularDiasDesdeAcceso()! <= 7" class="texto-verde">
                  Hace {{ calcularDiasDesdeAcceso() }} d√≠as
                </span>
                <span *ngIf="calcularDiasDesdeAcceso()! > 7" class="texto-naranja">
                  Inactivo {{ calcularDiasDesdeAcceso() }} d√≠as
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Permisos -->
        <div class="info-card permisos-card">
          <h2>üîê Permisos del Rol</h2>

          <div class="permisos-lista">
            <div class="permiso-item" *ngIf="usuario.rol === 'administrador'">
              <span class="permiso-check">‚úÖ</span>
              <div class="permiso-texto">
                <strong>Acceso Total al Sistema</strong>
                <p>Gesti√≥n completa de usuarios, casos, clientes y configuraci√≥n del sistema.</p>
              </div>
            </div>

            <div class="permiso-item" *ngIf="usuario.rol === 'abogado'">
              <span class="permiso-check">‚úÖ</span>
              <div class="permiso-texto">
                <strong>Gesti√≥n de Casos</strong>
                <p>Crear, editar y gestionar casos asignados.</p>
              </div>
            </div>

            <div class="permiso-item" *ngIf="usuario.rol === 'abogado'">
              <span class="permiso-check">‚úÖ</span>
              <div class="permiso-texto">
                <strong>Gesti√≥n de Citas</strong>
                <p>Agendar y administrar citas con clientes.</p>
              </div>
            </div>

            <div class="permiso-item" *ngIf="usuario.rol === 'asistente_legal'">
              <span class="permiso-check">‚úÖ</span>
              <div class="permiso-texto">
                <strong>Soporte Administrativo</strong>
                <p>Gestionar citas, clientes y dar soporte general.</p>
              </div>
            </div>

            <div class="permiso-item" *ngIf="usuario.rol === 'asistente_legal'">
              <span class="permiso-check">‚úÖ</span>
              <div class="permiso-texto">
                <strong>Visualizaci√≥n de Casos</strong>
                <p>Ver informaci√≥n de casos sin poder editarlos.</p>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Columna Derecha - Casos Asignados -->
      <div class="right-column">
        <div class="casos-card" *ngIf="usuario.rol === 'abogado'">
          <h2>üìÅ Casos Asignados</h2>

          <!-- Estad√≠stica -->
          <div class="casos-stat">
            <div class="stat-numero">{{ casosAsignados.length }}</div>
            <div class="stat-texto">Casos Asignados</div>
          </div>

          <!-- Lista de Casos -->
          <div class="casos-lista" *ngIf="casosAsignados.length > 0">
            <div class="caso-item" *ngFor="let caso of casosAsignados" (click)="verCaso(caso.id)">
              <div class="caso-header">
                <div class="caso-numero">{{ caso.numero_caso }}</div>
                <span class="caso-estado-badge" [ngClass]="getCasoEstadoClass(caso.estado)">
                  {{ getCasoEstadoTexto(caso.estado) }}
                </span>
              </div>
              <div class="caso-titulo">{{ caso.titulo }}</div>
              <div class="caso-info">
                <span class="caso-cliente">üë§ {{ caso.cliente }}</span>
                <span class="caso-fecha">üìÖ {{ formatearFechaCorta(caso.fecha_inicio) }}</span>
              </div>
            </div>
          </div>

          <!-- Sin Casos -->
          <div class="sin-casos" *ngIf="casosAsignados.length === 0">
            <div class="sin-casos-icon">üì≠</div>
            <p>Este abogado no tiene casos asignados actualmente</p>
          </div>
        </div>

        <!-- Info adicional para otros roles -->
        <div class="info-adicional-card" *ngIf="usuario.rol !== 'abogado'">
          <h2>‚ÑπÔ∏è Informaci√≥n Adicional</h2>

          <div class="info-box">
            <div class="info-box-icon">{{ getRolIcon(usuario.rol) }}</div>
            <div class="info-box-content">
              <h3>{{ getRolTexto(usuario.rol) }}</h3>
              <p *ngIf="usuario.rol === 'administrador'">
                Este usuario tiene permisos de administrador con acceso completo al sistema.
              </p>
              <p *ngIf="usuario.rol === 'asistente_legal'">
                Este usuario proporciona soporte administrativo y gestiona tareas generales del sistema.
              </p>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>
