<div class="form-container">
  <!-- Header -->
  <div class="form-header">
    <button class="btn-back" (click)="cancelar()">
      <i-lucide name="arrow-left" class="icon"></i-lucide>
      Volver
    </button>
    <h1>
      <i-lucide [name]="isEditMode ? 'edit' : 'plus-circle'" class="icon-title"></i-lucide>
      {{ isEditMode ? 'Editar Caso' : 'Nuevo Caso' }}
    </h1>
    <p>{{ isEditMode ? 'Modifica los datos del caso' : 'Completa el formulario para crear un nuevo caso' }}</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>{{ isEditMode ? 'Cargando caso...' : 'Guardando caso...' }}</p>
  </div>

  <!-- Formulario -->
  <form [formGroup]="casoForm" (ngSubmit)="onSubmit()" class="caso-form">

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-alert">
      <i-lucide name="alert-triangle" class="icon-alert"></i-lucide>
      {{ errorMessage }}
    </div>

    <!-- Sección: Información Básica -->
    <div class="form-section">
      <h2>
        <i-lucide name="clipboard-list" class="icon-section"></i-lucide>
        Información Básica
      </h2>

      <div class="form-group full-width">
        <label for="titulo">
          <i-lucide name="file-text" [size]="14" class="icon-label"></i-lucide>
          Título del Caso *
        </label>
        <input
          type="text"
          id="titulo"
          formControlName="titulo"
          placeholder="Ej: Demanda Laboral - Despido Injustificado"
          [class.error]="casoForm.get('titulo')?.invalid && casoForm.get('titulo')?.touched">
        <div class="error-message" *ngIf="casoForm.get('titulo')?.invalid && casoForm.get('titulo')?.touched">
          <i-lucide name="alert-circle" [size]="12" class="icon-error"></i-lucide>
          {{ getErrorMessage('titulo') }}
        </div>
      </div>

      <div class="form-group full-width">
        <label for="descripcion">
          <i-lucide name="align-left"  [size]="14" class="icon-label"></i-lucide>
          Descripción *
        </label>
        <textarea
          id="descripcion"
          formControlName="descripcion"
          rows="4"
          placeholder="Describe los detalles del caso..."
          [class.error]="casoForm.get('descripcion')?.invalid && casoForm.get('descripcion')?.touched"></textarea>
        <div class="error-message" *ngIf="casoForm.get('descripcion')?.invalid && casoForm.get('descripcion')?.touched">
          <i-lucide name="alert-circle" [size]="12" class="icon-error"></i-lucide>
          {{ getErrorMessage('descripcion') }}
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label for="tipo">
            <i-lucide name="folder" [size]="14" class="icon-label"></i-lucide>
            Tipo de Caso *
          </label>
          <select
            id="tipo"
            formControlName="tipo"
            [class.error]="casoForm.get('tipo')?.invalid && casoForm.get('tipo')?.touched">
            <option value="">Seleccione un tipo</option>
            <option *ngFor="let tipo of tiposCaso" [value]="tipo.value">
              {{ tipo.label }}
            </option>
          </select>
          <div class="error-message" *ngIf="casoForm.get('tipo')?.invalid && casoForm.get('tipo')?.touched">
            <i-lucide name="alert-circle"  [size]="12" class="icon-error"></i-lucide>
            El tipo es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="prioridad">
            <i-lucide name="flag" [size]="14" class="icon-label"></i-lucide>
            Prioridad *
          </label>
          <select id="prioridad" formControlName="prioridad">
            <option *ngFor="let prioridad of prioridades" [value]="prioridad.value">
              {{ prioridad.label }}
            </option>
          </select>
        </div>

        <div class="form-group" *ngIf="isEditMode">
          <label for="estado">
            <i-lucide name="activity" [size]="14" class="icon-label"></i-lucide>
            Estado
          </label>
          <select id="estado" formControlName="estado">
            <option *ngFor="let estado of estados" [value]="estado.value">
              {{ estado.label }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Sección: Participantes -->
    <div class="form-section">
      <h2>
        <i-lucide name="users" class="icon-section"></i-lucide>
        Participantes
      </h2>

      <div class="form-grid">
        <div class="form-group">
          <label for="cliente">
            <i-lucide name="user" [size]="14" class="icon-label"></i-lucide>
            Cliente *
          </label>
          <select
            id="cliente"
            formControlName="cliente"
            [class.error]="casoForm.get('cliente')?.invalid && casoForm.get('cliente')?.touched">
            <option value="">Seleccione un cliente</option>
            <option *ngFor="let cliente of clientes" [value]="cliente">
              {{ cliente }}
            </option>
          </select>
          <div class="error-message" *ngIf="casoForm.get('cliente')?.invalid && casoForm.get('cliente')?.touched">
            <i-lucide name="alert-circle" [size]="12" class="icon-error"></i-lucide>
            El cliente es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="abogado">
            <i-lucide name="briefcase" [size]="14" class="icon-label"></i-lucide>
            Abogado Asignado
          </label>
          <select id="abogado" formControlName="abogado">
            <option value="">Sin asignar</option>
            <option *ngFor="let abogado of abogados" [value]="abogado">
              {{ abogado }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Sección: Fechas y Montos -->
    <div class="form-section">
      <h2>
        <i-lucide name="calendar" class="icon-section"></i-lucide>
        Fechas y Montos
      </h2>

      <div class="form-grid">
        <div class="form-group">
          <label for="fecha_inicio">
            <i-lucide name="calendar-check" [size]="14" class="icon-label"></i-lucide>
            Fecha de Inicio *
          </label>
          <input
            type="date"
            id="fecha_inicio"
            formControlName="fecha_inicio"
            [class.error]="casoForm.get('fecha_inicio')?.invalid && casoForm.get('fecha_inicio')?.touched">
          <div class="error-message" *ngIf="casoForm.get('fecha_inicio')?.invalid && casoForm.get('fecha_inicio')?.touched">
            <i-lucide name="alert-circle" [size]="12" class="icon-error"></i-lucide>
            La fecha de inicio es requerida
          </div>
        </div>

        <div class="form-group" *ngIf="isEditMode">
          <label for="fecha_cierre">
            <i-lucide name="calendar-x" [size]="14" class="icon-label"></i-lucide>
            Fecha de Cierre
          </label>
          <input type="date" id="fecha_cierre" formControlName="fecha_cierre">
        </div>

        <div class="form-group">
          <label for="monto_reclamado">
            <i-lucide name="dollar-sign" [size]="14" class="icon-label"></i-lucide>
            Monto Reclamado ($)
          </label>
          <input
            type="number"
            id="monto_reclamado"
            formControlName="monto_reclamado"
            placeholder="0.00"
            step="0.01">
        </div>

        <div class="form-group" *ngIf="isEditMode">
          <label for="monto_ganado">
            <i-lucide name="coins" [size]="14" class="icon-label"></i-lucide>
            Monto Ganado ($)
          </label>
          <input
            type="number"
            id="monto_ganado"
            formControlName="monto_ganado"
            placeholder="0.00"
            step="0.01">
        </div>
      </div>
    </div>

    <!-- Sección: Detalles Legales -->
    <div class="form-section">
      <h2>
        <i-lucide name="scale"  class="icon-section"></i-lucide>
        Detalles Legales
      </h2>

      <div class="form-grid">
        <div class="form-group">
          <label for="juzgado">
            <i-lucide name="landmark" [size]="14" class="icon-label"></i-lucide>
            Juzgado
          </label>
          <select id="juzgado" formControlName="juzgado">
            <option value="">Seleccione un juzgado</option>
            <option *ngFor="let juzgado of juzgados" [value]="juzgado">
              {{ juzgado }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="numero_expediente">
            <i-lucide name="hash"  [size]="14" class="icon-label"></i-lucide>
            Número de Expediente
          </label>
          <input
            type="text"
            id="numero_expediente"
            formControlName="numero_expediente"
            placeholder="Ej: EXP-LAB-2025-001">
        </div>
      </div>

      <div class="form-group full-width">
        <label for="notas">
          <i-lucide name="file-edit" [size]="14" class="icon-label"></i-lucide>
          Notas / Observaciones
        </label>
        <textarea
          id="notas"
          formControlName="notas"
          rows="4"
          placeholder="Agregue notas adicionales sobre el caso..."></textarea>
      </div>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="cancelar()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn-primary" [disabled]="casoForm.invalid || loading">
        <span *ngIf="!loading">{{ isEditMode ? 'Actualizar Caso' : 'Crear Caso' }}</span>
        <span *ngIf="loading">Guardando...</span>
      </button>
    </div>

  </form>
</div>