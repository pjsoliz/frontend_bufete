<div class="form-container">
  <div class="form-header">
    <h1>{{ isEditMode ? '✏️ Editar Caso' : '➕ Nuevo Caso' }}</h1>
    <p>{{ isEditMode ? 'Actualiza la información del caso' : 'Completa el formulario para crear un nuevo caso' }}</p>
  </div>

  <div class="alert alert-success" *ngIf="successMessage">
    ✓ {{ successMessage }}
  </div>

  <div class="alert alert-danger" *ngIf="errorMessage">
    ✕ {{ errorMessage }}
  </div>

  <div *ngIf="loading && isEditMode" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando datos del caso...</p>
  </div>

  <form [formGroup]="casoForm" (ngSubmit)="onSubmit()" class="caso-form">

    <div class="form-group">
      <label for="titulo" class="form-label">Título del Caso *</label>
      <input
        type="text"
        id="titulo"
        formControlName="titulo"
        class="form-control"
        placeholder="Ej: Demanda Laboral - Despido Injustificado"
        [class.error]="titulo?.invalid && titulo?.touched">
      <div class="error-message" *ngIf="titulo?.invalid && titulo?.touched">
        <span *ngIf="titulo?.errors?.['required']">El título es requerido</span>
        <span *ngIf="titulo?.errors?.['minlength']">Mínimo 5 caracteres</span>
      </div>
    </div>

    <div class="form-group">
      <label for="descripcion" class="form-label">Descripción del Caso *</label>
      <textarea
        id="descripcion"
        formControlName="descripcion"
        class="form-control"
        rows="5"
        placeholder="Describe detalladamente el caso, incluye antecedentes, hechos relevantes y pretensiones..."
        [class.error]="descripcion?.invalid && descripcion?.touched"></textarea>
      <div class="error-message" *ngIf="descripcion?.invalid && descripcion?.touched">
        <span *ngIf="descripcion?.errors?.['required']">La descripción es requerida</span>
        <span *ngIf="descripcion?.errors?.['minlength']">Mínimo 20 caracteres</span>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="tipo_caso" class="form-label">Tipo de Caso *</label>
        <select
          id="tipo_caso"
          formControlName="tipo_caso"
          class="form-control">
          <option *ngFor="let tipo of tiposCaso" [value]="tipo.value">
            {{ tipo.label }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="prioridad" class="form-label">Prioridad *</label>
        <select
          id="prioridad"
          formControlName="prioridad"
          class="form-control">
          <option *ngFor="let prioridad of prioridades" [value]="prioridad.value">
            {{ prioridad.label }}
          </option>
        </select>
      </div>

      <div class="form-group" *ngIf="isEditMode">
        <label for="estado" class="form-label">Estado *</label>
        <select
          id="estado"
          formControlName="estado"
          class="form-control">
          <option *ngFor="let estado of estados" [value]="estado.value">
            {{ estado.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="cliente_id" class="form-label">ID Cliente *</label>
        <input
          type="number"
          id="cliente_id"
          formControlName="cliente_id"
          class="form-control"
          placeholder="Ej: 1"
          [class.error]="cliente_id?.invalid && cliente_id?.touched">
        <small class="form-text">Ingresa el ID del cliente (temporal)</small>
        <div class="error-message" *ngIf="cliente_id?.invalid && cliente_id?.touched">
          <span *ngIf="cliente_id?.errors?.['required']">El cliente es requerido</span>
        </div>
      </div>

      <div class="form-group">
        <label for="abogado_asignado_id" class="form-label">ID Abogado Asignado</label>
        <input
          type="number"
          id="abogado_asignado_id"
          formControlName="abogado_asignado_id"
          class="form-control"
          placeholder="Ej: 2">
        <small class="form-text">Opcional - Deja vacío para asignar después</small>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="monto_reclamado" class="form-label">Monto Reclamado</label>
        <input
          type="number"
          id="monto_reclamado"
          formControlName="monto_reclamado"
          class="form-control"
          placeholder="Ej: 50000"
          step="0.01">
        <small class="form-text">En la moneda local</small>
      </div>

      <div class="form-group" *ngIf="isEditMode">
        <label for="monto_ganado" class="form-label">Monto Ganado</label>
        <input
          type="number"
          id="monto_ganado"
          formControlName="monto_ganado"
          class="form-control"
          placeholder="Ej: 45000"
          step="0.01">
        <small class="form-text">Monto finalmente obtenido</small>
      </div>
    </div>

    <div class="form-group">
      <label for="notas_internas" class="form-label">Notas Internas</label>
      <textarea
        id="notas_internas"
        formControlName="notas_internas"
        class="form-control"
        rows="3"
        placeholder="Notas privadas, estrategias, observaciones internas..."></textarea>
      <small class="form-text">Solo visible para el equipo legal</small>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancelar()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="casoForm.invalid || loading">
        <span *ngIf="!loading">{{ isEditMode ? 'Actualizar Caso' : 'Crear Caso' }}</span>
        <span *ngIf="loading">Guardando...</span>
      </button>
    </div>

  </form>
</div>
