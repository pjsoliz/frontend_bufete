<div class="casos-container">
  <!-- Header -->
  <div class="casos-header">
    <div class="header-left">
      <h1>
        <lucide-icon name="folder-open" [size]="32"></lucide-icon>
        Gestión de Casos
      </h1>
      <p>Administra todos los casos del sistema</p>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="nuevoCaso()">
        <lucide-icon name="plus" [size]="20"></lucide-icon>
        Nuevo Caso
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-section">
    <div class="stat-card blue">
      <div class="stat-icon">
        <lucide-icon name="briefcase" [size]="28"></lucide-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total Casos</div>
      </div>
    </div>

    <div class="stat-card orange">
      <div class="stat-icon">
        <lucide-icon name="clock" [size]="28"></lucide-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.pendientes }}</div>
        <div class="stat-label">Pendientes</div>
      </div>
    </div>

    <div class="stat-card green">
      <div class="stat-icon">
        <lucide-icon name="zap" [size]="28"></lucide-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.en_progreso }}</div>
        <div class="stat-label">En Progreso</div>
      </div>
    </div>

    <div class="stat-card purple">
      <div class="stat-icon">
        <lucide-icon name="check-circle" [size]="28"></lucide-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.cerrados }}</div>
        <div class="stat-label">Cerrados</div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="filtros-grid">
      <div class="filtro-item">
        <label>
          <lucide-icon name="search" [size]="16" class="icon-label"></lucide-icon>
          Buscar
        </label>
        <input
          type="text"
          placeholder="Buscar por número, título, cliente..."
          [(ngModel)]="filtroBusqueda"
          (input)="onFiltroChange()">
      </div>

      <div class="filtro-item">
        <label>
          <lucide-icon name="activity" [size]="16" class="icon-label"></lucide-icon>
          Estado
        </label>
        <select [(ngModel)]="filtroEstado" (change)="onFiltroChange()">
          <option value="todos">Todos</option>
          <option value="en_progreso">En Progreso</option>
          <option value="suspendido">Suspendido</option>
          <option value="cerrado">Cerrado</option>
        </select>
      </div>

      <div class="filtro-item">
        <label>
          <lucide-icon name="scale" [size]="16" class="icon-label"></lucide-icon>
          Tipo
        </label>
        <select [(ngModel)]="filtroTipo" (change)="onFiltroChange()">
          <option value="todos">Todos</option>
          <option value="civil">Civil</option>
          <option value="penal">Penal</option>
          <option value="familia">Familiar</option>
        </select>
      </div>

      <div class="filtro-item">
        <label>
          <lucide-icon name="flag" [size]="16" class="icon-label"></lucide-icon>
          Prioridad
        </label>
        <select [(ngModel)]="filtroPrioridad" (change)="onFiltroChange()">
          <option value="todos">Todas</option>
          <option value="baja">Baja</option>
          <option value="media">Media</option>
          <option value="alta">Alta</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando casos...</p>
  </div>

  <!-- Lista de Casos -->
  <div *ngIf="!loading" class="casos-content">

    <!-- Contador -->
    <div class="contador">
      Mostrando <strong>{{ casosFiltrados.length }}</strong> de <strong>{{ casos.length }}</strong> casos
    </div>

    <!-- Sin resultados -->
    <div *ngIf="casosFiltrados.length === 0" class="sin-resultados">
      <div class="sin-resultados-icon">
        <lucide-icon name="search-x" [size]="64"></lucide-icon>
      </div>
      <h3>No se encontraron casos</h3>
      <p>Intenta ajustar los filtros o crea un nuevo caso</p>
      <button class="btn-primary" (click)="nuevoCaso()">
        <lucide-icon name="plus" [size]="20"></lucide-icon>
        Nuevo Caso
      </button>
    </div>

    <!-- Tabla de Casos -->
    <div *ngIf="casosFiltrados.length > 0" class="casos-table-container">
      <table class="casos-table">
        <thead>
          <tr>
            <th>N° Caso</th>
            <th>Título</th>
            <th>Cliente</th>
            <th>Abogado</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Prioridad</th>
            <th>Fecha Inicio</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let caso of casosFiltrados"
              class="caso-row"
              (click)="verDetalle(caso.id)">

            <td>
              <div class="numero-caso">
                <span class="numero-badge">{{ caso.numero_caso }}</span>
              </div>
            </td>

            <td>
              <div class="titulo-caso">
                <div class="titulo">{{ caso.titulo }}</div>
                <div class="subtitulo" *ngIf="caso.juzgado">
                  <lucide-icon name="map-pin" [size]="14"></lucide-icon>
                  {{ caso.juzgado }}
                </div>
              </div>
            </td>

            <td>
              <div class="cliente-info">
                <lucide-icon name="user" [size]="16" class="icono"></lucide-icon>
                <span>{{ caso.cliente }}</span>
              </div>
            </td>

            <td>
              <div class="abogado-info">
                <lucide-icon *ngIf="caso.abogado" name="briefcase" [size]="16" class="icono"></lucide-icon>
                <span *ngIf="caso.abogado">{{ caso.abogado }}</span>
                <span *ngIf="!caso.abogado" class="sin-asignar">
                  <lucide-icon name="user-x" [size]="16"></lucide-icon>
                  Sin asignar
                </span>
              </div>
            </td>

            <td>
              <span class="tipo-badge" [ngClass]="getTipoClass(caso.tipo)">
                {{ getTipoTexto(caso.tipo) }}
              </span>
            </td>

            <td>
              <span class="estado-badge" [ngClass]="getEstadoClass(caso.estado)">
                {{ getEstadoTexto(caso.estado) }}
              </span>
            </td>

            <td>
              <span class="prioridad-badge" [ngClass]="getPrioridadClass(caso.prioridad)">
                {{ getPrioridadTexto(caso.prioridad) }}
              </span>
            </td>

            <td>
              <div class="fecha">
                <lucide-icon name="calendar" [size]="14"></lucide-icon>
                {{ formatearFecha(caso.fecha_inicio) }}
              </div>
            </td>

            <td class="acciones-cell" (click)="$event.stopPropagation()">
              <div class="acciones-buttons">
                <button
                  class="btn-accion btn-ver"
                  (click)="verDetalle(caso.id)"
                  title="Ver detalle">
                  <lucide-icon name="eye" [size]="16"></lucide-icon>
                </button>

                <button
                  class="btn-accion btn-editar"
                  (click)="editarCaso(caso.id, $event)"
                  title="Editar">
                  <lucide-icon name="pencil" [size]="16"></lucide-icon>
                </button>

                <button
                  class="btn-accion btn-eliminar"
                  (click)="eliminarCaso(caso.id, $event)"
                  title="Eliminar">
                  <lucide-icon name="trash-2" [size]="16"></lucide-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>